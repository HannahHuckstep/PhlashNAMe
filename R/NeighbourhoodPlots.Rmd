---
title: "R Notebook"
output: html_notebook
---


```{r}
library(ggplot2)
library(dplyr)
library(viridis)
library(ggExtra)

dn <- "~/Documents/neo4j/PhlashyName/liveDemo/"

# Proteins
experiments <- read.csv(paste0(dn, "experiments.tsv"), header = TRUE,sep = '\t')

```

```{r}
bt <- function(a, b, p) {binom.test(a, b, p, alternative= c("greater"), conf.level = 0.95)$p.value}

for (ex in experiments$Experiments) {
  currData <- read.csv(paste0(dn, paste0(paste0("BinomialNeighbourhoods_",ex),".tsv")), header = TRUE,sep = '\t')
  
currData <- transform(currData, integrated = ifelse(NumIntegrated > 0, "Yes","No"))
currData$log2Ascore <-log2(currData$AvgAScore)

currData$rPVal <- mapply(bt, currData$NumMeasuredNbhd, currData$dbMeasured, currData$probablility)
currData$Bonferoni <- p.adjust(currData$rPVal, method = "bonferroni")
currData$BH <- p.adjust(currData$rPVal, method = "BH")

p<- ggplot(currData, aes(x=Bonferoni, y = AvgSScore)) + 
  geom_point(alpha = 0.7,  aes(color = AvgAScore)) + 
  scale_color_viridis(option = "A" )+
  geom_vline(xintercept = 0.05, linetype = "dotted")+
  ggtitle(paste0(ex,"\nNeighborhood, Depth 4"))+
  ylab("Support Score")+
  xlab("Bonferroni corrected Pvalue")+
  theme_minimal() +
  theme(legend.position = "bottom")


print(ggMarginal(p, type="histogram"))

  
  
}

```


This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

